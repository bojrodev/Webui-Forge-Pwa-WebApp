<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bojro Resolver</title>
    
    <meta name="theme-color" content="#121212">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="manifest" href="manifest.json">
    <link rel="manifest" id="dynamic-manifest">
    <link rel="apple-touch-icon" id="apple-icon" href="icon.png">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="installBanner" class="hidden">‚¨áÔ∏è INSTALL BOJRO (FULL SCREEN)</div>

    <h2>Bojro Elegance<br>Diffusion Resolver</h2>

    <div class="tab-bar">
        <div class="tab active" onclick="switchTab('gen')">GEN</div>
        <div class="tab" onclick="switchTab('gal')">GALLERY</div>
        <div class="tab" onclick="switchTab('ana')">ANALYZER</div>
    </div>

    <div id="view-gen">
        <div id="connBar" class="row">
            <input type="text" id="hostIp" placeholder="Enter full WebUI URL (http://192.168.x.x:7860)" value="">
            <button onclick="connect()" class="btn-small">LINK</button>
            <div id="statusDot" class="indicator"></div>
        </div>

        <div class="col">
            <label>Checkpoint</label>
            <div class="row">
                <select id="modelSelect" onchange="changeModel()"><option>Link first.....</option></select>
                <button onclick="setDefaultModel()" class="btn-small" style="padding: 8px 12px;">‚≠ê</button>
            </div>
        </div>
        
        <div class="col">
            <label>VAE</label>
            <input type="text" value="Automatic (SDXL Default)" readonly style="color: #ccc; background: #222; border-color: #444;">
        </div>
        
        <div class="col">
            <label>Diffusion Bits</label>
            <input type="text" value="Automatic (SDXL Default)" readonly style="color: #ccc; background: #222; border-color: #444;">
        </div>

        <div class="col">
            <label>Prompt</label>
            <textarea id="prompt">1girl, hand fan, solo, black hair, long hair, jewelry, earrings, holding, chinese clothes, hair ornament, holding fan, red nails, looking at viewer, upper body, long sleeves, red lips, folding fan, smoke, hanfu, nail polish,masterpiece,best quality,</textarea>
            <button onclick="openLoraModal()" class="btn-small" style="width: 100%; background: #222; border: 1px dashed #555; margin-bottom: 5px;">+ SELECT LORA</button>
            <label>Negative Prompt</label>
            <textarea id="neg" style="min-height: 50px;">bad quality,worst quality,worst detail,</textarea>
        </div>

        <div class="row">
            <div class="col">
                <label>Sampler</label>
                <select id="samplerSelect"><option>Euler a</option></select>
            </div>
            <div class="col">
                <label>Schedule</label>
                <select id="schedulerSelect"><option>Karras</option></select>
            </div>
        </div>

        <div class="row">
            <div class="col"><label>Steps</label><input type="number" id="steps" value="20"></div>
            <div class="col"><label>CFG</label><input type="number" id="cfg" value="7"></div>
        </div>
        <div class="row">
            <div class="col"><label>Width</label><input type="number" id="width" value="768" step="64"></div>
            <div class="col"><label>Height</label><input type="number" id="height" value="1365" step="64"></div>
        </div>
        
        <div id="resSelector">
            <label style="margin-top: 10px;">Quick Aspect Ratio Switches</label>
            <div id="resGrid">
                <div class="mp-label">1 MP</div>
                <div class="res-switch" onclick="setResolution(1024, 1024)">1:1</div>
                <div class="res-switch" onclick="setResolution(1254, 836)">3:2</div>
                <div class="res-switch" onclick="setResolution(1182, 887)">4:3</div>
                <div class="res-switch" onclick="setResolution(1365, 768)">16:9</div>
                <div class="res-switch" onclick="setResolution(1564, 670)">21:9</div>
                
                <div class="mp-label">2 MP</div>
                <div class="res-switch" onclick="setResolution(1448, 1448)">1:1</div>
                <div class="res-switch" onclick="setResolution(1773, 1182)">3:2</div>
                <div class="res-switch" onclick="setResolution(1672, 1254)">4:3</div>
                <div class="res-switch" onclick="setResolution(1936, 1089)">16:9</div>
                <div class="res-switch" onclick="flipResolution()">W‚ÜîH</div>
            </div>
        </div>
        <div class="row">
            <div class="col"><label>Batch Size</label><input type="number" id="batchSize" value="1"></div>
            <div class="col"><label>Batch Count</label><input type="number" id="batchCount" value="1"></div>
        </div>

        <div class="col">
            <label>Seed (-1 for Random)</label>
            <div class="row" style="gap: 5px;">
                <input type="number" id="seed" value="-1" placeholder="-1">
                <button onclick="document.getElementById('seed').value = '-1'" class="btn-small" style="padding: 12px; width: auto;">üé≤</button>
            </div>
        </div>

        <button id="genBtn" onclick="generate()" disabled>GENERATE</button>
        
        <div class="row" style="margin-top: 10px; justify-content: center; background: #222; padding: 8px; border-radius: 8px; border: 1px solid #333;">
            <input type="checkbox" id="autoDlCheck" style="width: auto; margin-right: 10px;" onchange="saveAutoDlState()">
            <label for="autoDlCheck" style="margin: 0; cursor: pointer; color: #ccc; font-weight: bold; font-size: 13px;">Auto-Save Images</label>
        </div>

        <div id="gallery"><div class="spinner" id="loadingSpinner"></div></div>
        <button id="dlBtn" class="btn-small hidden" onclick="downloadResults()" style="width:100%; margin-top:10px; background:#2196F3; color:white; padding:15px;">‚¨áÔ∏è DOWNLOAD RESULTS</button>
        <div id="metaData" class="meta-box hidden"></div>
    </div>

    <div id="view-gal" class="hidden">
        <div class="row" style="justify-content: space-between; margin-bottom: 10px;">
            <label style="font-size: 14px;">SAVED HISTORY</label>
            <button onclick="clearDbGallery()" class="btn-small" style="background: #f44336;">CLEAR ALL</button>
        </div>
        <div id="savedGalleryGrid">
            <div style="text-align:center; color:#666; margin-top:50px;">Generate images to see them here.</div>
        </div>
    </div>

    <div id="view-ana" class="hidden">
        <label for="imageUpload">
            <div id="uploadBox">
                <div style="font-weight: bold; color: #888;">TAP TO UPLOAD</div>
                <div style="font-size: 12px; color: #555;">JPG, PNG, WEBP</div>
            </div>
        </label>
        <input type="file" id="imageUpload" accept="image/*" class="hidden" onchange="handleFileSelect(event)">
        <div class="grid-info">
            <div class="info-card"><div class="info-label">Resolution</div><div id="resOut" class="info-val">-- x --</div></div>
            <div class="info-card"><div class="info-label">Aspect Ratio</div><div id="arOut" class="info-val">--</div></div>
            <div class="info-card" style="grid-column: span 2;"><div class="info-label">Date</div><div id="dateOut" class="info-val">N/A</div></div>
        </div>
        <div id="anaGallery" class="hidden" style="margin-top: 15px; border-radius: 8px; overflow: hidden; border: 1px solid var(--border);">
            <img id="anaPreview" style="width: 100%; display: block;">
        </div>
        <div style="margin-top: 15px;">
            <label>Metadata / Prompts</label>
            <div id="anaMeta" class="meta-box" style="min-height: 100px;">Load an image to extract data...</div>
        </div>
    </div>

    <div id="loraModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header"><h3>Select LoRA</h3><button onclick="closeLoraModal()" class="close-btn">‚úï</button></div>
            <input type="text" id="loraSearch" placeholder="Search LoRAs..." onkeyup="filterLoras()">
            <div id="loraVerticalList"></div>
        </div>
    </div>

    <div id="fullScreenModal" class="modal hidden" style="background: rgba(0,0,0,0.95);">
        <img id="fsImage" style="max-width: 100%; max-height: 80vh; object-fit: contain;">
        <div class="row" style="position: absolute; bottom: 30px; gap: 15px;">
            <button onclick="closeFsModal()" class="btn-small" style="background: #333;">CLOSE</button>
            <button onclick="analyzeCurrentFs()" class="btn-small" style="background: var(--accent); color: black;">üîç SEE METADATA</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>